From a011c3b514a211a7c43e74a152012ca72aadca1b Mon Sep 17 00:00:00 2001
From: Adrian Stratulat <adrian.stratulat91@gmail.com>
Date: Tue, 19 Sep 2023 19:18:07 +0000
Subject: [PATCH] disable strlcat/strlcpy implementations

---
 external/misc/strlcat.c | 6 ++++--
 external/misc/strlcpy.c | 5 ++++-
 src/direwolf.h          | 4 ++++
 3 files changed, 12 insertions(+), 3 deletions(-)

diff --git a/external/misc/strlcat.c b/external/misc/strlcat.c
index 87f9c42..7384f6c 100644
--- a/external/misc/strlcat.c
+++ b/external/misc/strlcat.c
@@ -55,7 +55,8 @@
  * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
  */
 
-
+#if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 37)
+#else
 
 /*
  * Appends src to string dst of size siz (unlike strncat, siz is the
@@ -124,4 +125,5 @@ the_end:
 	}
 #endif
 	return (retval);
-}
\ No newline at end of file
+}
+#endif
diff --git a/external/misc/strlcpy.c b/external/misc/strlcpy.c
index ff18800..d31b6ce 100644
--- a/external/misc/strlcpy.c
+++ b/external/misc/strlcpy.c
@@ -56,6 +56,9 @@
 
 #include "textcolor.h"
 
+#if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 37)
+#else
+
 /*
  * Copy src to string dst of size siz.  At most siz-1 characters
  * will be copied.  Always NUL terminates (unless siz == 0).
@@ -117,4 +120,4 @@ size_t strlcpy_debug(char *__restrict__ dst, const char *__restrict__ src, size_
 #endif
 	return (retval);
 }
-
+#endif
diff --git a/src/direwolf.h b/src/direwolf.h
index efc329b..95e8964 100644
--- a/src/direwolf.h
+++ b/src/direwolf.h
@@ -286,6 +286,10 @@ char *strcasestr(const char *S, const char *FIND);
 
 // strlcpy and strlcat should be in string.h and the C library.
 
+#elif __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 37)
+
+// glibc 2.38 implements them
+
 #else   // Use our own copy
 
 
-- 
2.34.1

